<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oppgave 172A</title>
</head>

<body>
    <div id="app"></div>
    <script>
        // model
        let tasks = [{
            text: "Vaske gulvet",
            doneDate: '',
            responsible: 'Per Ivar',
            isDone: false,
        }];
        let taskInput = '';
        let responsibleInput = '';
        // view
        updateView();

        function updateView() {
            let tableTaskHTML = '';
            
            for (let i = 0; i < tasks.length; i++) {
                tableTaskHTML += createTaskHTML(i)
            }

            document.getElementById('app').innerHTML = /*HTML*/`
                <input type="text" oninput="taskInput=this.value" value="${taskInput}">
                <input type="text" oninput="responsibleInput=this.value" value="${responsibleInput}"> <br />
                <button onclick="addTask()">Click me</button>
                <br/><table>
                    <tr>
                        <th>Oppgave</th>    
                        <th>Dato</th>    
                        <th>Ansvarlig</th>    
                        <th>Knapper</th>    
                    </tr>
                ${tableTaskHTML}
                </table>
            `;


        }

        function createTaskHTML(index) {
            let task = tasks[index];
            task.doneDate = task.isDone ? new Date().toLocaleDateString() : '';
            let check = task.isDone ? 'CHECKED' : ''

            return  /*HTML*/ `
            <tr>
                <td>${task.text}</td>    
                <td>${task.doneDate}</td>    
                <td>${task.responsible}</td>    
                <td>
                    <button onclick="deleteTask(${index})">Slett oppgave</button>
                    <button onclick="editTask(${index})">Rediger oppgave</button>
                    <input type="checkbox" onchange="setTaskDone(${index}, this.checked)" ${check}>
                </td> 
            </tr>
            `;
        }

        // controller

        function setTaskDone(index, isChecked) {
            console.log(isChecked);
            tasks[index].isDone = isChecked;

            updateView();
        }

        function resetInputValues(){
            taskInput = '';
            responsibleInput = '';
        }

        function addTask() {
            if(taskInput == '' || responsibleInput == '') {
                resetInputValues();
                updateView();
                return;
            }
            let task = {
                text: taskInput,
                doneDate: '',
                responsible: responsibleInput,
                isDone: false,
            };
            
            resetInputValues();
            tasks.push(task);
            updateView();   
        }
        function editTask() {
            
        }

    </script>
</body>

</html>